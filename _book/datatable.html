<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 data.table | R (BGU course)</title>
  <meta name="description" content="Class notes for the R course at the BGU MGMT faculty." />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 data.table | R (BGU course)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Class notes for the R course at the BGU MGMT faculty." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 data.table | R (BGU course)" />
  
  <meta name="twitter:description" content="Class notes for the R course at the BGU MGMT faculty." />
  

<meta name="author" content="Jonathan D. Rosenblatt" />


<meta name="date" content="2019-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basics.html">
<link rel="next" href="eda.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/sequences-0.1/sequences.css" rel="stylesheet" />
<script src="libs/sunburst-binding-2.1.0/sunburst.js"></script>
<script src="libs/d3-5.7.0/d3.min.js"></script>
<script src="libs/d3-lasso-0.0.5/d3-lasso.min.js"></script>
<link href="libs/ggiraphjs-0.1.0/styles.css" rel="stylesheet" />
<script src="libs/ggiraphjs-0.1.0/ggiraphjs.min.js"></script>
<script src="libs/girafe-binding-0.6.0/girafe.js"></script>
<script src="libs/plotly-binding-4.9.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.46.1/plotly-latest.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Course</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#notation-conventions"><i class="fa fa-check"></i><b>1.1</b> Notation Conventions</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#what-r"><i class="fa fa-check"></i><b>2.1</b> What is R?</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#ecosystem"><i class="fa fa-check"></i><b>2.2</b> The R Ecosystem</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#bibliographic-notes"><i class="fa fa-check"></i><b>2.3</b> Bibliographic Notes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>3</b> R Basics</a><ul>
<li class="chapter" data-level="3.0.1" data-path="basics.html"><a href="basics.html#other-ides"><i class="fa fa-check"></i><b>3.0.1</b> Other IDEs</a></li>
<li class="chapter" data-level="3.1" data-path="basics.html"><a href="basics.html#file-types"><i class="fa fa-check"></i><b>3.1</b> File types</a></li>
<li class="chapter" data-level="3.2" data-path="basics.html"><a href="basics.html#simple-calculator"><i class="fa fa-check"></i><b>3.2</b> Simple calculator</a></li>
<li class="chapter" data-level="3.3" data-path="basics.html"><a href="basics.html#probability-calculator"><i class="fa fa-check"></i><b>3.3</b> Probability calculator</a></li>
<li class="chapter" data-level="3.4" data-path="basics.html"><a href="basics.html#getting-help"><i class="fa fa-check"></i><b>3.4</b> Getting Help</a></li>
<li class="chapter" data-level="3.5" data-path="basics.html"><a href="basics.html#variable-asignment"><i class="fa fa-check"></i><b>3.5</b> Variable Asignment</a></li>
<li class="chapter" data-level="3.6" data-path="basics.html"><a href="basics.html#missing"><i class="fa fa-check"></i><b>3.6</b> Missing</a></li>
<li class="chapter" data-level="3.7" data-path="basics.html"><a href="basics.html#piping"><i class="fa fa-check"></i><b>3.7</b> Piping</a></li>
<li class="chapter" data-level="3.8" data-path="basics.html"><a href="basics.html#vector-creation-and-manipulation"><i class="fa fa-check"></i><b>3.8</b> Vector Creation and Manipulation</a></li>
<li class="chapter" data-level="3.9" data-path="basics.html"><a href="basics.html#search-paths-and-packages"><i class="fa fa-check"></i><b>3.9</b> Search Paths and Packages</a></li>
<li class="chapter" data-level="3.10" data-path="basics.html"><a href="basics.html#simple-plotting"><i class="fa fa-check"></i><b>3.10</b> Simple Plotting</a></li>
<li class="chapter" data-level="3.11" data-path="basics.html"><a href="basics.html#object-types"><i class="fa fa-check"></i><b>3.11</b> Object Types</a></li>
<li class="chapter" data-level="3.12" data-path="basics.html"><a href="basics.html#data-frames"><i class="fa fa-check"></i><b>3.12</b> Data Frames</a></li>
<li class="chapter" data-level="3.13" data-path="basics.html"><a href="basics.html#exctraction"><i class="fa fa-check"></i><b>3.13</b> Exctraction</a></li>
<li class="chapter" data-level="3.14" data-path="basics.html"><a href="basics.html#augmentations-of-the-data.frame-class"><i class="fa fa-check"></i><b>3.14</b> Augmentations of the data.frame class</a></li>
<li class="chapter" data-level="3.15" data-path="basics.html"><a href="basics.html#data-import-and-export"><i class="fa fa-check"></i><b>3.15</b> Data Import and Export</a><ul>
<li class="chapter" data-level="3.15.1" data-path="basics.html"><a href="basics.html#import-from-web"><i class="fa fa-check"></i><b>3.15.1</b> Import from WEB</a></li>
<li class="chapter" data-level="3.15.2" data-path="basics.html"><a href="basics.html#import-from-clipboard"><i class="fa fa-check"></i><b>3.15.2</b> Import From Clipboard</a></li>
<li class="chapter" data-level="3.15.3" data-path="basics.html"><a href="basics.html#export-as-csv"><i class="fa fa-check"></i><b>3.15.3</b> Export as CSV</a></li>
<li class="chapter" data-level="3.15.4" data-path="basics.html"><a href="basics.html#export-non-csv-files"><i class="fa fa-check"></i><b>3.15.4</b> Export non-CSV files</a></li>
<li class="chapter" data-level="3.15.5" data-path="basics.html"><a href="basics.html#reading-from-text-files"><i class="fa fa-check"></i><b>3.15.5</b> Reading From Text Files</a></li>
<li class="chapter" data-level="3.15.6" data-path="basics.html"><a href="basics.html#writing-data-to-text-files"><i class="fa fa-check"></i><b>3.15.6</b> Writing Data to Text Files</a></li>
<li class="chapter" data-level="3.15.7" data-path="basics.html"><a href="basics.html#xlsx-files"><i class="fa fa-check"></i><b>3.15.7</b> .XLS(X) files</a></li>
<li class="chapter" data-level="3.15.8" data-path="basics.html"><a href="basics.html#massive-files"><i class="fa fa-check"></i><b>3.15.8</b> Massive files</a></li>
<li class="chapter" data-level="3.15.9" data-path="basics.html"><a href="basics.html#databases"><i class="fa fa-check"></i><b>3.15.9</b> Databases</a></li>
</ul></li>
<li class="chapter" data-level="3.16" data-path="basics.html"><a href="basics.html#functions"><i class="fa fa-check"></i><b>3.16</b> Functions</a></li>
<li class="chapter" data-level="3.17" data-path="basics.html"><a href="basics.html#looping"><i class="fa fa-check"></i><b>3.17</b> Looping</a></li>
<li class="chapter" data-level="3.18" data-path="basics.html"><a href="basics.html#apply"><i class="fa fa-check"></i><b>3.18</b> Apply</a></li>
<li class="chapter" data-level="3.19" data-path="basics.html"><a href="basics.html#recursion"><i class="fa fa-check"></i><b>3.19</b> Recursion</a></li>
<li class="chapter" data-level="3.20" data-path="basics.html"><a href="basics.html#strings"><i class="fa fa-check"></i><b>3.20</b> Strings</a></li>
<li class="chapter" data-level="3.21" data-path="basics.html"><a href="basics.html#dates-and-times"><i class="fa fa-check"></i><b>3.21</b> Dates and Times</a><ul>
<li class="chapter" data-level="3.21.1" data-path="basics.html"><a href="basics.html#dates"><i class="fa fa-check"></i><b>3.21.1</b> Dates</a></li>
<li class="chapter" data-level="3.21.2" data-path="basics.html"><a href="basics.html#times"><i class="fa fa-check"></i><b>3.21.2</b> Times</a></li>
<li class="chapter" data-level="3.21.3" data-path="basics.html"><a href="basics.html#lubridate-package"><i class="fa fa-check"></i><b>3.21.3</b> lubridate Package</a></li>
</ul></li>
<li class="chapter" data-level="3.22" data-path="basics.html"><a href="basics.html#complex-objects"><i class="fa fa-check"></i><b>3.22</b> Complex Objects</a></li>
<li class="chapter" data-level="3.23" data-path="basics.html"><a href="basics.html#vectors-and-matrix-products"><i class="fa fa-check"></i><b>3.23</b> Vectors and Matrix Products</a></li>
<li class="chapter" data-level="3.24" data-path="basics.html"><a href="basics.html#bibliographic-notes-1"><i class="fa fa-check"></i><b>3.24</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="3.25" data-path="basics.html"><a href="basics.html#practice-yourself"><i class="fa fa-check"></i><b>3.25</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datatable.html"><a href="datatable.html"><i class="fa fa-check"></i><b>4</b> data.table</a><ul>
<li class="chapter" data-level="4.1" data-path="datatable.html"><a href="datatable.html#make-your-own-variables"><i class="fa fa-check"></i><b>4.1</b> Make your own variables</a></li>
<li class="chapter" data-level="4.2" data-path="datatable.html"><a href="datatable.html#join"><i class="fa fa-check"></i><b>4.2</b> Join</a></li>
<li class="chapter" data-level="4.3" data-path="datatable.html"><a href="datatable.html#reshaping-data"><i class="fa fa-check"></i><b>4.3</b> Reshaping data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="datatable.html"><a href="datatable.html#wide-to-long"><i class="fa fa-check"></i><b>4.3.1</b> Wide to long</a></li>
<li class="chapter" data-level="4.3.2" data-path="datatable.html"><a href="datatable.html#long-to-wide"><i class="fa fa-check"></i><b>4.3.2</b> Long to wide</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="datatable.html"><a href="datatable.html#bibliographic-notes-2"><i class="fa fa-check"></i><b>4.4</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="4.5" data-path="datatable.html"><a href="datatable.html#practice-yourself-1"><i class="fa fa-check"></i><b>4.5</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>5</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="eda.html"><a href="eda.html#summary-statistics"><i class="fa fa-check"></i><b>5.1</b> Summary Statistics</a><ul>
<li class="chapter" data-level="5.1.1" data-path="eda.html"><a href="eda.html#categorical-data"><i class="fa fa-check"></i><b>5.1.1</b> Categorical Data</a></li>
<li class="chapter" data-level="5.1.2" data-path="eda.html"><a href="eda.html#continous-data"><i class="fa fa-check"></i><b>5.1.2</b> Continous Data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="eda.html"><a href="eda.html#visualization"><i class="fa fa-check"></i><b>5.2</b> Visualization</a><ul>
<li class="chapter" data-level="5.2.1" data-path="eda.html"><a href="eda.html#categorical-data-1"><i class="fa fa-check"></i><b>5.2.1</b> Categorical Data</a></li>
<li class="chapter" data-level="5.2.2" data-path="eda.html"><a href="eda.html#continuous-data"><i class="fa fa-check"></i><b>5.2.2</b> Continuous Data</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="eda.html"><a href="eda.html#mixed-type-data"><i class="fa fa-check"></i><b>5.3</b> Mixed Type Data</a><ul>
<li class="chapter" data-level="5.3.1" data-path="eda.html"><a href="eda.html#alluvial"><i class="fa fa-check"></i><b>5.3.1</b> Alluvial Diagram</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="eda.html"><a href="eda.html#bibliographic-notes-3"><i class="fa fa-check"></i><b>5.4</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="5.5" data-path="eda.html"><a href="eda.html#practice-yourself-2"><i class="fa fa-check"></i><b>5.5</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="lm.html"><a href="lm.html"><i class="fa fa-check"></i><b>6</b> Linear Models</a><ul>
<li class="chapter" data-level="6.1" data-path="lm.html"><a href="lm.html#problem-setup"><i class="fa fa-check"></i><b>6.1</b> Problem Setup</a></li>
<li class="chapter" data-level="6.2" data-path="lm.html"><a href="lm.html#ols-estimation-in-r"><i class="fa fa-check"></i><b>6.2</b> OLS Estimation in R</a></li>
<li class="chapter" data-level="6.3" data-path="lm.html"><a href="lm.html#inference"><i class="fa fa-check"></i><b>6.3</b> Inference</a><ul>
<li class="chapter" data-level="6.3.1" data-path="lm.html"><a href="lm.html#testing-a-hypothesis-on-a-single-coefficient"><i class="fa fa-check"></i><b>6.3.1</b> Testing a Hypothesis on a Single Coefficient</a></li>
<li class="chapter" data-level="6.3.2" data-path="lm.html"><a href="lm.html#constructing-a-confidence-interval-on-a-single-coefficient"><i class="fa fa-check"></i><b>6.3.2</b> Constructing a Confidence Interval on a Single Coefficient</a></li>
<li class="chapter" data-level="6.3.3" data-path="lm.html"><a href="lm.html#multiple-regression"><i class="fa fa-check"></i><b>6.3.3</b> Multiple Regression</a></li>
<li class="chapter" data-level="6.3.4" data-path="lm.html"><a href="lm.html#anova"><i class="fa fa-check"></i><b>6.3.4</b> ANOVA (*)</a></li>
<li class="chapter" data-level="6.3.5" data-path="lm.html"><a href="lm.html#testing-a-hypothesis-on-a-single-contrast"><i class="fa fa-check"></i><b>6.3.5</b> Testing a Hypothesis on a Single Contrast (*)</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="lm.html"><a href="lm.html#bibliographic-notes-4"><i class="fa fa-check"></i><b>6.4</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="6.5" data-path="lm.html"><a href="lm.html#practice-yourself-3"><i class="fa fa-check"></i><b>6.5</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>7</b> Generalized Linear Models</a><ul>
<li class="chapter" data-level="7.1" data-path="glm.html"><a href="glm.html#problem-setup-1"><i class="fa fa-check"></i><b>7.1</b> Problem Setup</a></li>
<li class="chapter" data-level="7.2" data-path="glm.html"><a href="glm.html#logistic-regression"><i class="fa fa-check"></i><b>7.2</b> Logistic Regression</a><ul>
<li class="chapter" data-level="7.2.1" data-path="glm.html"><a href="glm.html#logistic-regression-with-r"><i class="fa fa-check"></i><b>7.2.1</b> Logistic Regression with R</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="glm.html"><a href="glm.html#poisson-regression"><i class="fa fa-check"></i><b>7.3</b> Poisson Regression</a></li>
<li class="chapter" data-level="7.4" data-path="glm.html"><a href="glm.html#extensions"><i class="fa fa-check"></i><b>7.4</b> Extensions</a></li>
<li class="chapter" data-level="7.5" data-path="glm.html"><a href="glm.html#bibliographic-notes-5"><i class="fa fa-check"></i><b>7.5</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="7.6" data-path="glm.html"><a href="glm.html#practice-glm"><i class="fa fa-check"></i><b>7.6</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="lme.html"><a href="lme.html"><i class="fa fa-check"></i><b>8</b> Linear Mixed Models</a><ul>
<li class="chapter" data-level="8.1" data-path="lme.html"><a href="lme.html#problem-setup-2"><i class="fa fa-check"></i><b>8.1</b> Problem Setup</a><ul>
<li class="chapter" data-level="8.1.1" data-path="lme.html"><a href="lme.html#non-linear-mixed-models"><i class="fa fa-check"></i><b>8.1.1</b> Non-Linear Mixed Models</a></li>
<li class="chapter" data-level="8.1.2" data-path="lme.html"><a href="lme.html#generalized-linear-mixed-models-glmm"><i class="fa fa-check"></i><b>8.1.2</b> Generalized Linear Mixed Models (GLMM)</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="lme.html"><a href="lme.html#mixed-models-with-r"><i class="fa fa-check"></i><b>8.2</b> Mixed Models with R</a><ul>
<li class="chapter" data-level="8.2.1" data-path="lme.html"><a href="lme.html#a-single-random-effect"><i class="fa fa-check"></i><b>8.2.1</b> A Single Random Effect</a></li>
<li class="chapter" data-level="8.2.2" data-path="lme.html"><a href="lme.html#multiple-random-effects"><i class="fa fa-check"></i><b>8.2.2</b> Multiple Random Effects</a></li>
<li class="chapter" data-level="8.2.3" data-path="lme.html"><a href="lme.html#a-full-mixed-model"><i class="fa fa-check"></i><b>8.2.3</b> A Full Mixed-Model</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="lme.html"><a href="lme.html#serial"><i class="fa fa-check"></i><b>8.3</b> Serial Correlations</a></li>
<li class="chapter" data-level="8.4" data-path="lme.html"><a href="lme.html#extensions-1"><i class="fa fa-check"></i><b>8.4</b> Extensions</a><ul>
<li class="chapter" data-level="8.4.1" data-path="lme.html"><a href="lme.html#cluster-robust-standard-errors"><i class="fa fa-check"></i><b>8.4.1</b> Cluster Robust Standard Errors</a></li>
<li class="chapter" data-level="8.4.2" data-path="lme.html"><a href="lme.html#linear-models-for-panel-data"><i class="fa fa-check"></i><b>8.4.2</b> Linear Models for Panel Data</a></li>
<li class="chapter" data-level="8.4.3" data-path="lme.html"><a href="lme.html#testing-hypotheses-on-correlations"><i class="fa fa-check"></i><b>8.4.3</b> Testing Hypotheses on Correlations</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="lme.html"><a href="lme.html#relation-to-other-estimators"><i class="fa fa-check"></i><b>8.5</b> Relation to Other Estimators</a><ul>
<li class="chapter" data-level="8.5.1" data-path="lme.html"><a href="lme.html#fixed-effects-in-the-econometric-literature"><i class="fa fa-check"></i><b>8.5.1</b> Fixed Effects in the Econometric Literature</a></li>
<li class="chapter" data-level="8.5.2" data-path="lme.html"><a href="lme.html#relation-to-generalized-least-squares-gls"><i class="fa fa-check"></i><b>8.5.2</b> Relation to Generalized Least Squares (GLS)</a></li>
<li class="chapter" data-level="8.5.3" data-path="lme.html"><a href="lme.html#relation-to-conditional-gaussian-fields"><i class="fa fa-check"></i><b>8.5.3</b> Relation to Conditional Gaussian Fields</a></li>
<li class="chapter" data-level="8.5.4" data-path="lme.html"><a href="lme.html#relation-to-empirical-risk-minimization-erm"><i class="fa fa-check"></i><b>8.5.4</b> Relation to Empirical Risk Minimization (ERM)</a></li>
<li class="chapter" data-level="8.5.5" data-path="lme.html"><a href="lme.html#relation-to-m-estimation"><i class="fa fa-check"></i><b>8.5.5</b> Relation to M-Estimation</a></li>
<li class="chapter" data-level="8.5.6" data-path="lme.html"><a href="lme.html#relation-to-generalize-estimating-equations-gee"><i class="fa fa-check"></i><b>8.5.6</b> Relation to Generalize Estimating Equations (GEE)</a></li>
<li class="chapter" data-level="8.5.7" data-path="lme.html"><a href="lme.html#manova"><i class="fa fa-check"></i><b>8.5.7</b> Relation to MANOVA</a></li>
<li class="chapter" data-level="8.5.8" data-path="lme.html"><a href="lme.html#relation-to-seemingly-unrelated-equations-sur"><i class="fa fa-check"></i><b>8.5.8</b> Relation to Seemingly Unrelated Equations (SUR)</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="lme.html"><a href="lme.html#bibliographic-notes-6"><i class="fa fa-check"></i><b>8.6</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="8.7" data-path="lme.html"><a href="lme.html#practice-yourself-4"><i class="fa fa-check"></i><b>8.7</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="multivariate.html"><a href="multivariate.html"><i class="fa fa-check"></i><b>9</b> Multivariate Data Analysis</a><ul>
<li class="chapter" data-level="9.1" data-path="multivariate.html"><a href="multivariate.html#signal-detection"><i class="fa fa-check"></i><b>9.1</b> Signal Detection</a><ul>
<li class="chapter" data-level="9.1.1" data-path="multivariate.html"><a href="multivariate.html#hotellings-t2-test"><i class="fa fa-check"></i><b>9.1.1</b> Hotelling’s T2 Test</a></li>
<li class="chapter" data-level="9.1.2" data-path="multivariate.html"><a href="multivariate.html#various-types-of-signal-to-detect"><i class="fa fa-check"></i><b>9.1.2</b> Various Types of Signal to Detect</a></li>
<li class="chapter" data-level="9.1.3" data-path="multivariate.html"><a href="multivariate.html#simes-test"><i class="fa fa-check"></i><b>9.1.3</b> Simes’ Test</a></li>
<li class="chapter" data-level="9.1.4" data-path="multivariate.html"><a href="multivariate.html#signal-detection-with-r"><i class="fa fa-check"></i><b>9.1.4</b> Signal Detection with R</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="multivariate.html"><a href="multivariate.html#signal-counting"><i class="fa fa-check"></i><b>9.2</b> Signal Counting</a></li>
<li class="chapter" data-level="9.3" data-path="multivariate.html"><a href="multivariate.html#identification"><i class="fa fa-check"></i><b>9.3</b> Signal Identification</a><ul>
<li class="chapter" data-level="9.3.1" data-path="multivariate.html"><a href="multivariate.html#signal-identification-in-r"><i class="fa fa-check"></i><b>9.3.1</b> Signal Identification in R</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="multivariate.html"><a href="multivariate.html#signal-estimation"><i class="fa fa-check"></i><b>9.4</b> Signal Estimation (*)</a></li>
<li class="chapter" data-level="9.5" data-path="multivariate.html"><a href="multivariate.html#bibliographic-notes-7"><i class="fa fa-check"></i><b>9.5</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="9.6" data-path="multivariate.html"><a href="multivariate.html#practice-yourself-5"><i class="fa fa-check"></i><b>9.6</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="supervised.html"><a href="supervised.html"><i class="fa fa-check"></i><b>10</b> Supervised Learning</a><ul>
<li class="chapter" data-level="10.1" data-path="supervised.html"><a href="supervised.html#problem-setup-3"><i class="fa fa-check"></i><b>10.1</b> Problem Setup</a><ul>
<li class="chapter" data-level="10.1.1" data-path="supervised.html"><a href="supervised.html#common-hypothesis-classes"><i class="fa fa-check"></i><b>10.1.1</b> Common Hypothesis Classes</a></li>
<li class="chapter" data-level="10.1.2" data-path="supervised.html"><a href="supervised.html#common-complexity-penalties"><i class="fa fa-check"></i><b>10.1.2</b> Common Complexity Penalties</a></li>
<li class="chapter" data-level="10.1.3" data-path="supervised.html"><a href="supervised.html#unbiased-risk-estimation"><i class="fa fa-check"></i><b>10.1.3</b> Unbiased Risk Estimation</a></li>
<li class="chapter" data-level="10.1.4" data-path="supervised.html"><a href="supervised.html#collecting-the-pieces"><i class="fa fa-check"></i><b>10.1.4</b> Collecting the Pieces</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="supervised.html"><a href="supervised.html#supervised-learning-in-r"><i class="fa fa-check"></i><b>10.2</b> Supervised Learning in R</a><ul>
<li class="chapter" data-level="10.2.1" data-path="supervised.html"><a href="supervised.html#least-squares"><i class="fa fa-check"></i><b>10.2.1</b> Linear Models with Least Squares Loss</a></li>
<li class="chapter" data-level="10.2.2" data-path="supervised.html"><a href="supervised.html#svm"><i class="fa fa-check"></i><b>10.2.2</b> SVM</a></li>
<li class="chapter" data-level="10.2.3" data-path="supervised.html"><a href="supervised.html#neural-nets"><i class="fa fa-check"></i><b>10.2.3</b> Neural Nets</a></li>
<li class="chapter" data-level="10.2.4" data-path="supervised.html"><a href="supervised.html#trees"><i class="fa fa-check"></i><b>10.2.4</b> Classification and Regression Trees (CART)</a></li>
<li class="chapter" data-level="10.2.5" data-path="supervised.html"><a href="supervised.html#k-nearest-neighbour-knn"><i class="fa fa-check"></i><b>10.2.5</b> K-nearest neighbour (KNN)</a></li>
<li class="chapter" data-level="10.2.6" data-path="supervised.html"><a href="supervised.html#linear-discriminant-analysis-lda"><i class="fa fa-check"></i><b>10.2.6</b> Linear Discriminant Analysis (LDA)</a></li>
<li class="chapter" data-level="10.2.7" data-path="supervised.html"><a href="supervised.html#naive-bayes"><i class="fa fa-check"></i><b>10.2.7</b> Naive Bayes</a></li>
<li class="chapter" data-level="10.2.8" data-path="supervised.html"><a href="supervised.html#random-forrest"><i class="fa fa-check"></i><b>10.2.8</b> Random Forrest</a></li>
<li class="chapter" data-level="10.2.9" data-path="supervised.html"><a href="supervised.html#boosting"><i class="fa fa-check"></i><b>10.2.9</b> Boosting</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="supervised.html"><a href="supervised.html#bibliographic-notes-8"><i class="fa fa-check"></i><b>10.3</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="10.4" data-path="supervised.html"><a href="supervised.html#practice-yourself-6"><i class="fa fa-check"></i><b>10.4</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>11</b> Plotting</a><ul>
<li class="chapter" data-level="11.1" data-path="plotting.html"><a href="plotting.html#the-graphics-system"><i class="fa fa-check"></i><b>11.1</b> The graphics System</a><ul>
<li class="chapter" data-level="11.1.1" data-path="plotting.html"><a href="plotting.html#using-existing-plotting-functions"><i class="fa fa-check"></i><b>11.1.1</b> Using Existing Plotting Functions</a></li>
<li class="chapter" data-level="11.1.2" data-path="plotting.html"><a href="plotting.html#exporting-a-plot"><i class="fa fa-check"></i><b>11.1.2</b> Exporting a Plot</a></li>
<li class="chapter" data-level="11.1.3" data-path="plotting.html"><a href="plotting.html#fancy"><i class="fa fa-check"></i><b>11.1.3</b> Fancy graphics Examples</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="plotting.html"><a href="plotting.html#the-ggplot2-system"><i class="fa fa-check"></i><b>11.2</b> The ggplot2 System</a><ul>
<li class="chapter" data-level="11.2.1" data-path="plotting.html"><a href="plotting.html#extensions-of-the-ggplot2-system"><i class="fa fa-check"></i><b>11.2.1</b> Extensions of the ggplot2 System</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="plotting.html"><a href="plotting.html#interactive-graphics"><i class="fa fa-check"></i><b>11.3</b> Interactive Graphics</a><ul>
<li class="chapter" data-level="11.3.1" data-path="plotting.html"><a href="plotting.html#plotly"><i class="fa fa-check"></i><b>11.3.1</b> Plotly</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="plotting.html"><a href="plotting.html#other-r-interfaces-to-javascript-plotting"><i class="fa fa-check"></i><b>11.4</b> Other R Interfaces to JavaScript Plotting</a></li>
<li class="chapter" data-level="11.5" data-path="plotting.html"><a href="plotting.html#bibliographic-notes-9"><i class="fa fa-check"></i><b>11.5</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="11.6" data-path="plotting.html"><a href="plotting.html#practice-yourself-7"><i class="fa fa-check"></i><b>11.6</b> Practice Yourself</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="report.html"><a href="report.html"><i class="fa fa-check"></i><b>12</b> Reports</a><ul>
<li class="chapter" data-level="12.1" data-path="report.html"><a href="report.html#knitr"><i class="fa fa-check"></i><b>12.1</b> knitr</a><ul>
<li class="chapter" data-level="12.1.1" data-path="report.html"><a href="report.html#installation"><i class="fa fa-check"></i><b>12.1.1</b> Installation</a></li>
<li class="chapter" data-level="12.1.2" data-path="report.html"><a href="report.html#pandoc-markdown"><i class="fa fa-check"></i><b>12.1.2</b> Pandoc Markdown</a></li>
<li class="chapter" data-level="12.1.3" data-path="report.html"><a href="report.html#rmarkdown"><i class="fa fa-check"></i><b>12.1.3</b> Rmarkdown</a></li>
<li class="chapter" data-level="12.1.4" data-path="report.html"><a href="report.html#bibtex"><i class="fa fa-check"></i><b>12.1.4</b> BibTex</a></li>
<li class="chapter" data-level="12.1.5" data-path="report.html"><a href="report.html#compiling"><i class="fa fa-check"></i><b>12.1.5</b> Compiling</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="report.html"><a href="report.html#bookdown"><i class="fa fa-check"></i><b>12.2</b> bookdown</a></li>
<li class="chapter" data-level="12.3" data-path="report.html"><a href="report.html#shiny"><i class="fa fa-check"></i><b>12.3</b> Shiny</a><ul>
<li class="chapter" data-level="12.3.1" data-path="report.html"><a href="report.html#installation-1"><i class="fa fa-check"></i><b>12.3.1</b> Installation</a></li>
<li class="chapter" data-level="12.3.2" data-path="report.html"><a href="report.html#the-basics-of-shiny"><i class="fa fa-check"></i><b>12.3.2</b> The Basics of Shiny</a></li>
<li class="chapter" data-level="12.3.3" data-path="report.html"><a href="report.html#beyond-the-basics"><i class="fa fa-check"></i><b>12.3.3</b> Beyond the Basics</a></li>
<li class="chapter" data-level="12.3.4" data-path="report.html"><a href="report.html#shinydashboard"><i class="fa fa-check"></i><b>12.3.4</b> shinydashboard</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="report.html"><a href="report.html#flexdashboard"><i class="fa fa-check"></i><b>12.4</b> flexdashboard</a></li>
<li class="chapter" data-level="12.5" data-path="report.html"><a href="report.html#bibliographic-notes-10"><i class="fa fa-check"></i><b>12.5</b> Bibliographic Notes</a></li>
<li class="chapter" data-level="12.6" data-path="report.html"><a href="report.html#practice-yourself-8"><i class="fa fa-check"></i><b>12.6</b> Practice Yourself</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R (BGU course)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datatable" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> data.table</h1>
<p><code>data.table</code> is an excellent extension of the <code>data.frame</code> class. If used as a <code>data.frame</code> it will look and feel like a data frame. If, however, it is used with it’s unique capabilities, it will prove faster and easier to manipulate. This is because <code>data.frame</code>s, like most of R objects, make a copy of themselves when modified. This is known as <a href="https://stackoverflow.com/questions/373419/whats-the-difference-between-passing-by-reference-vs-passing-by-value">passing by value</a>, and it is done to ensure that object are not corrupted if an operation fails (if your computer shuts down before the operation is completed, for instance). Making copies of large objects is clearly time and memory consuming. A <code>data.table</code> can make changes in place. This is known as <a href="https://stackoverflow.com/questions/373419/whats-the-difference-between-passing-by-reference-vs-passing-by-value">passing by reference</a>, which is considerably faster than passing by value.</p>
<p>Let’s start with importing some freely available car sales data from <a href="https://www.kaggle.com/orgesleka/used-cars-database">Kaggle</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)
<span class="kw">library</span>(magrittr)
auto &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&#39;data/autos.csv&#39;</span>)</code></pre></div>
<pre><code>## Warning in fread(&quot;data/autos.csv&quot;): Found and resolved improper
## quoting out-of-sample. First healed line 5263: &lt;&lt;2016-03-29
## 16:46:46,&quot;_SPARDOSE&quot;______Polo_1_4___6N1___60PS___5Tuerer____FESTPREIS,privat,Angebot,
## 500,control,limousine,1999,manuell,60,polo,150000,12,benzin,volkswagen,ja,
## 2016-03-25 00:00:00,0,59581,2016-03-30 11:46:58&gt;&gt;. If the fields are
## not quoted (e.g. field separator does not appear within any field), try
## quote=&quot;&quot; to avoid this warning.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(auto)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(auto) <span class="co">#  Rows and columns</span></code></pre></div>
<pre><code>## [1] 371824     20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(auto) <span class="co"># Variable names</span></code></pre></div>
<pre><code>##  [1] &quot;dateCrawled&quot;         &quot;name&quot;                &quot;seller&quot;             
##  [4] &quot;offerType&quot;           &quot;price&quot;               &quot;abtest&quot;             
##  [7] &quot;vehicleType&quot;         &quot;yearOfRegistration&quot;  &quot;gearbox&quot;            
## [10] &quot;powerPS&quot;             &quot;model&quot;               &quot;kilometer&quot;          
## [13] &quot;monthOfRegistration&quot; &quot;fuelType&quot;            &quot;brand&quot;              
## [16] &quot;notRepairedDamage&quot;   &quot;dateCreated&quot;         &quot;nrOfPictures&quot;       
## [19] &quot;postalCode&quot;          &quot;lastSeen&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(auto) <span class="co"># Object class</span></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">file.info</span>(<span class="st">&#39;data/autos.csv&#39;</span>) <span class="co"># File info on disk</span></code></pre></div>
<pre><code>##                    size isdir mode               mtime               ctime
## data/autos.csv 68439217 FALSE  644 2019-02-24 23:52:04 2019-02-24 23:52:04
##                              atime  uid  gid   uname  grname
## data/autos.csv 2019-03-27 22:15:55 1000 1000 johnros johnros</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gdata<span class="op">::</span><span class="kw">humanReadable</span>(<span class="dv">68439217</span>)</code></pre></div>
<pre><code>## [1] &quot;65.3 MiB&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">object.size</span>(auto) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">units =</span> <span class="st">&#39;auto&#39;</span>) <span class="co"># File size in memory</span></code></pre></div>
<pre><code>## 103.3 Mb</code></pre>
<p>Things to note:</p>
<ul>
<li>The import has been done with <code>fread</code> instead of <code>read.csv</code>. This is more efficient, and directly creates a <code>data.table</code> object.</li>
<li>The import is very fast.</li>
<li>The data after import is slightly larger than when stored on disk (in this case). The extra data allows faster operation of this object, and the rule of thumb is to have 3 to 5 times more <a href="https://en.wikipedia.org/wiki/Random-access_memory">RAM</a> than file size (e.g.: 4GB RAM for 1GB file)</li>
<li><code>auto</code> has two classes. It means that everything that expects a <code>data.frame</code> we can feed it a <code>data.table</code> and it will work.</li>
</ul>
<p>Let’s start with verifying that it behaves like a <code>data.frame</code> when expected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="dv">2</span>] <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>##                                                  name
## 1:                                         Golf_3_1.6
## 2:                               A5_Sportback_2.7_Tdi
## 3:                     Jeep_Grand_Cherokee_&quot;Overland&quot;
## 4:                              GOLF_4_1_4__3T\xdcRER
## 5:                     Skoda_Fabia_1.4_TDI_PD_Classic
## 6: BMW_316i___e36_Limousine___Bastlerfahrzeug__Export</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[[<span class="dv">2</span>]] <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>## [1] &quot;Golf_3_1.6&quot;                                        
## [2] &quot;A5_Sportback_2.7_Tdi&quot;                              
## [3] &quot;Jeep_Grand_Cherokee_\&quot;Overland\&quot;&quot;                  
## [4] &quot;GOLF_4_1_4__3T\xdcRER&quot;                             
## [5] &quot;Skoda_Fabia_1.4_TDI_PD_Classic&quot;                    
## [6] &quot;BMW_316i___e36_Limousine___Bastlerfahrzeug__Export&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[<span class="dv">1</span>,<span class="dv">2</span>] <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>##          name
## 1: Golf_3_1.6</code></pre>
<p>But notice the difference between <code>data.frame</code> and <code>data.table</code> when subsetting multiple rows. Uhh!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="op">%&gt;%</span><span class="st"> </span>dim <span class="co"># data.table will exctract *rows*</span></code></pre></div>
<pre><code>## [1]  3 20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.data.frame</span>(auto)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="op">%&gt;%</span><span class="st"> </span>dim <span class="co"># data.frame will exctract *columns*</span></code></pre></div>
<pre><code>## [1] 371824      3</code></pre>
<p>Just use columns (<code>,</code>) and be explicit regarding the dimension you are extracting…</p>
<p>Now let’s do some <code>data.table</code> specific operations. The general syntax has the form <code>DT[i,j,by]</code>. SQL users may think of <code>i</code> as <code>WHERE</code>, <code>j</code> as <code>SELECT</code>, and <code>by</code> as <code>GROUP BY</code>. We don’t need to name the arguments explicitly. Also, the <code>Tab</code> key will typically help you to fill in column names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,vehicleType,] <span class="op">%&gt;%</span><span class="st"> </span>table <span class="co"># Exctract column and tabulate</span></code></pre></div>
<pre><code>## .
##                andere        bus     cabrio      coupe kleinwagen 
##      37899       3362      30220      22914      19026      80098 
##      kombi  limousine        suv 
##      67626      95963      14716</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[vehicleType<span class="op">==</span><span class="st">&#39;coupe&#39;</span>,,] <span class="op">%&gt;%</span><span class="st"> </span>dim <span class="co"># Exctract rows </span></code></pre></div>
<pre><code>## [1] 19026    20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,gearbox<span class="op">:</span>model,] <span class="op">%&gt;%</span><span class="st"> </span>head <span class="co"># exctract column range</span></code></pre></div>
<pre><code>##      gearbox powerPS model
## 1:   manuell       0  golf
## 2:   manuell     190      
## 3: automatik     163 grand
## 4:   manuell      75  golf
## 5:   manuell      69 fabia
## 6:   manuell     102   3er</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,gearbox,] <span class="op">%&gt;%</span><span class="st"> </span>table</code></pre></div>
<pre><code>## .
##           automatik   manuell 
##     20223     77169    274432</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[vehicleType<span class="op">==</span><span class="st">&#39;coupe&#39;</span> <span class="op">&amp;</span><span class="st"> </span>gearbox<span class="op">==</span><span class="st">&#39;automatik&#39;</span>,,] <span class="op">%&gt;%</span><span class="st"> </span>dim <span class="co"># intersect conditions</span></code></pre></div>
<pre><code>## [1] 6008   20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">table</span>(vehicleType),] <span class="co"># uhh? why would this even work?!?</span></code></pre></div>
<pre><code>## vehicleType
##                andere        bus     cabrio      coupe kleinwagen 
##      37899       3362      30220      22914      19026      80098 
##      kombi  limousine        suv 
##      67626      95963      14716</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[, <span class="kw">mean</span>(price), by=vehicleType] <span class="co"># average price by car group</span></code></pre></div>
<pre><code>## Warning in gmean(price): The sum of an integer column for a group was more
## than type &#39;integer&#39; can hold so the result has been coerced to &#39;numeric&#39;
## automatically for convenience.</code></pre>
<pre><code>##    vehicleType         V1
## 1:              20124.688
## 2:       coupe  25951.506
## 3:         suv  13252.392
## 4:  kleinwagen   5691.167
## 5:   limousine  11111.107
## 6:      cabrio  15072.998
## 7:         bus  10300.686
## 8:       kombi   7739.518
## 9:      andere 676327.100</code></pre>
<p>The <code>.N</code> operator is very useful if you need to count the length of the result. Notice where I use it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[.N,,] <span class="co"># will exctract the *last* row</span></code></pre></div>
<pre><code>##            dateCrawled                                         name seller
## 1: 2016-03-07 19:39:19 BMW_M135i_vollausgestattet_NP_52.720____Euro privat
##    offerType price  abtest vehicleType yearOfRegistration gearbox powerPS
## 1:   Angebot 28990 control   limousine               2013 manuell     320
##      model kilometer monthOfRegistration fuelType brand notRepairedDamage
## 1: m_reihe     50000                   8   benzin   bmw              nein
##            dateCreated nrOfPictures postalCode            lastSeen
## 1: 2016-03-07 00:00:00            0      73326 2016-03-22 03:17:10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,.N] <span class="co"># will count rows</span></code></pre></div>
<pre><code>## [1] 371824</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,.N, vehicleType] <span class="co"># will count rows by type</span></code></pre></div>
<pre><code>##    vehicleType     N
## 1:             37899
## 2:       coupe 19026
## 3:         suv 14716
## 4:  kleinwagen 80098
## 5:   limousine 95963
## 6:      cabrio 22914
## 7:         bus 30220
## 8:       kombi 67626
## 9:      andere  3362</code></pre>
<p>You may concatenate results into a vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">c</span>(<span class="kw">mean</span>(price), <span class="kw">mean</span>(powerPS)),]</code></pre></div>
<pre><code>## [1] 17286.2996   115.5414</code></pre>
<p>This <code>c()</code> syntax no longer behaves well if splitting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">c</span>(<span class="kw">mean</span>(price), <span class="kw">mean</span>(powerPS)), by=vehicleType]</code></pre></div>
<pre><code>##     vehicleType           V1
##  1:              20124.68801
##  2:                 71.23249
##  3:       coupe  25951.50589
##  4:       coupe    172.97614
##  5:         suv  13252.39182
##  6:         suv    166.01903
##  7:  kleinwagen   5691.16738
##  8:  kleinwagen     68.75733
##  9:   limousine  11111.10661
## 10:   limousine    132.26936
## 11:      cabrio  15072.99782
## 12:      cabrio    145.17684
## 13:         bus  10300.68561
## 14:         bus    113.58137
## 15:       kombi   7739.51760
## 16:       kombi    136.40654
## 17:      andere 676327.09964
## 18:      andere    102.11154</code></pre>
<p>Use a <code>list()</code> instead of <code>c()</code>, within <code>data.table</code> commands:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">list</span>(<span class="kw">mean</span>(price), <span class="kw">mean</span>(powerPS)), by=vehicleType]</code></pre></div>
<pre><code>## Warning in gmean(price): The sum of an integer column for a group was more
## than type &#39;integer&#39; can hold so the result has been coerced to &#39;numeric&#39;
## automatically for convenience.</code></pre>
<pre><code>##    vehicleType         V1        V2
## 1:              20124.688  71.23249
## 2:       coupe  25951.506 172.97614
## 3:         suv  13252.392 166.01903
## 4:  kleinwagen   5691.167  68.75733
## 5:   limousine  11111.107 132.26936
## 6:      cabrio  15072.998 145.17684
## 7:         bus  10300.686 113.58137
## 8:       kombi   7739.518 136.40654
## 9:      andere 676327.100 102.11154</code></pre>
<p>You can add names to your new variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">list</span>(<span class="dt">Price=</span><span class="kw">mean</span>(price), <span class="dt">Power=</span><span class="kw">mean</span>(powerPS)), by=vehicleType]</code></pre></div>
<pre><code>## Warning in gmean(price): The sum of an integer column for a group was more
## than type &#39;integer&#39; can hold so the result has been coerced to &#39;numeric&#39;
## automatically for convenience.</code></pre>
<pre><code>##    vehicleType      Price     Power
## 1:              20124.688  71.23249
## 2:       coupe  25951.506 172.97614
## 3:         suv  13252.392 166.01903
## 4:  kleinwagen   5691.167  68.75733
## 5:   limousine  11111.107 132.26936
## 6:      cabrio  15072.998 145.17684
## 7:         bus  10300.686 113.58137
## 8:       kombi   7739.518 136.40654
## 9:      andere 676327.100 102.11154</code></pre>
<p>You can use <code>.()</code> to replace the longer <code>list()</code> command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,.(<span class="dt">Price=</span><span class="kw">mean</span>(price), <span class="dt">Power=</span><span class="kw">mean</span>(powerPS)), by=vehicleType]</code></pre></div>
<pre><code>## Warning in gmean(price): The sum of an integer column for a group was more
## than type &#39;integer&#39; can hold so the result has been coerced to &#39;numeric&#39;
## automatically for convenience.</code></pre>
<pre><code>##    vehicleType      Price     Power
## 1:              20124.688  71.23249
## 2:       coupe  25951.506 172.97614
## 3:         suv  13252.392 166.01903
## 4:  kleinwagen   5691.167  68.75733
## 5:   limousine  11111.107 132.26936
## 6:      cabrio  15072.998 145.17684
## 7:         bus  10300.686 113.58137
## 8:       kombi   7739.518 136.40654
## 9:      andere 676327.100 102.11154</code></pre>
<p>And split by multiple variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,.(<span class="dt">Price=</span><span class="kw">mean</span>(price), <span class="dt">Power=</span><span class="kw">mean</span>(powerPS)), by=.(vehicleType,fuelType)] <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>## Warning in gmean(price): The sum of an integer column for a group was more
## than type &#39;integer&#39; can hold so the result has been coerced to &#39;numeric&#39;
## automatically for convenience.</code></pre>
<pre><code>##    vehicleType fuelType     Price     Power
## 1:               benzin 11820.443  70.14477
## 2:       coupe   diesel 51170.248 179.48704
## 3:         suv   diesel 15549.369 168.16115
## 4:  kleinwagen   benzin  5786.514  68.74309
## 5:  kleinwagen   diesel  4295.550  76.83666
## 6:   limousine   benzin  6974.360 127.87025</code></pre>
<p>Compute with variables created on the fly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">sum</span>(price<span class="op">&lt;</span><span class="fl">1e4</span>),] <span class="co"># Count prices lower than 10,000</span></code></pre></div>
<pre><code>## [1] 310497</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">mean</span>(price<span class="op">&lt;</span><span class="fl">1e4</span>),] <span class="co"># Proportion of prices lower than 10,000</span></code></pre></div>
<pre><code>## [1] 0.8350644</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,.(<span class="dt">Power=</span><span class="kw">mean</span>(powerPS)), by=.(<span class="dt">PriceRange=</span>price<span class="op">&gt;</span><span class="fl">1e4</span>)] </code></pre></div>
<pre><code>##    PriceRange    Power
## 1:      FALSE 101.8838
## 2:       TRUE 185.9029</code></pre>
<p>Things to note:</p>
<ul>
<li>The term <code>price&lt;1e4</code> creates <em>on the fly</em> a binary vector of TRUE=1 / FALSE=0 for prices less than 10k and then sums/means this vector, hence <code>sum</code> is actually a count, and <code>mean</code> is proportion=count/total</li>
<li>Summing all prices lower than 10k is done with the command <code>auto[price&lt;1e4,sum(price),]</code></li>
</ul>
<p>You may sort along one or more columns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[<span class="kw">order</span>(<span class="op">-</span>price), price,] <span class="op">%&gt;%</span><span class="st"> </span>head <span class="co"># Order along price. Descending</span></code></pre></div>
<pre><code>## [1] 2147483647   99999999   99999999   99999999   99999999   99999999</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[<span class="kw">order</span>(price, <span class="op">-</span>lastSeen), price,] <span class="op">%&gt;%</span><span class="st"> </span>head<span class="co"># Order along price and last seen . Ascending and descending.</span></code></pre></div>
<pre><code>## [1] 0 0 0 0 0 0</code></pre>
<p>You may apply a function to ALL columns using a Subset of the Data using <code>.SD</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">count.uniques &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x))
auto[,<span class="kw">lapply</span>(.SD, count.uniques), vehicleType]</code></pre></div>
<pre><code>##    vehicleType dateCrawled  name seller offerType price abtest
## 1:                   36714 32891      1         2  1378      2
## 2:       coupe       18745 13182      1         2  1994      2
## 3:         suv       14549  9707      1         1  1667      2
## 4:  kleinwagen       75591 49302      2         2  1927      2
## 5:   limousine       89352 58581      2         1  2986      2
## 6:      cabrio       22497 13411      1         1  2014      2
## 7:         bus       29559 19651      1         2  1784      2
## 8:       kombi       64415 41976      2         1  2529      2
## 9:      andere        3352  3185      1         1   562      2
##    yearOfRegistration gearbox powerPS model kilometer monthOfRegistration
## 1:                101       3     374   244        13                  13
## 2:                 75       3     414   117        13                  13
## 3:                 73       3     342   122        13                  13
## 4:                 75       3     317   163        13                  13
## 5:                 83       3     506   210        13                  13
## 6:                 88       3     363    95        13                  13
## 7:                 65       3     251   106        13                  13
## 8:                 64       3     393   177        13                  13
## 9:                 81       3     230   162        13                  13
##    fuelType brand notRepairedDamage dateCreated nrOfPictures postalCode
## 1:        8    40                 3          65            1       6304
## 2:        8    35                 3          51            1       5159
## 3:        8    37                 3          61            1       4932
## 4:        8    38                 3          68            1       7343
## 5:        8    39                 3          82            1       7513
## 6:        7    38                 3          70            1       5524
## 7:        8    33                 3          63            1       6112
## 8:        8    38                 3          75            1       7337
## 9:        8    38                 3          41            1       2220
##    lastSeen
## 1:    32813
## 2:    16568
## 3:    13367
## 4:    59354
## 5:    65813
## 6:    19125
## 7:    26094
## 8:    50668
## 9:     3294</code></pre>
<p>Things to note:</p>
<ul>
<li><code>.SD</code> is the data subset after splitting along the <code>by</code> argument.</li>
<li>Recall that <code>lapply</code> applies the same function to all elements of a list. In this example, to all columns of <code>.SD</code>.</li>
</ul>
<p>If you want to apply a function only to a subset of columns, use the <code>.SDcols</code> argument</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">lapply</span>(.SD, count.uniques), by=vehicleType, .SDcols=price<span class="op">:</span>gearbox]</code></pre></div>
<pre><code>##    vehicleType price abtest vehicleType yearOfRegistration gearbox
## 1:              1378      2           1                101       3
## 2:       coupe  1994      2           1                 75       3
## 3:         suv  1667      2           1                 73       3
## 4:  kleinwagen  1927      2           1                 75       3
## 5:   limousine  2986      2           1                 83       3
## 6:      cabrio  2014      2           1                 88       3
## 7:         bus  1784      2           1                 65       3
## 8:       kombi  2529      2           1                 64       3
## 9:      andere   562      2           1                 81       3</code></pre>
<div id="make-your-own-variables" class="section level2">
<h2><span class="header-section-number">4.1</span> Make your own variables</h2>
<p>It is very easy to compute new variables</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">log</span>(price<span class="op">/</span>powerPS),] <span class="op">%&gt;%</span><span class="st"> </span>head <span class="co"># This makes no sense</span></code></pre></div>
<pre><code>## [1]      Inf 4.567632 4.096387 2.995732 3.954583 1.852000</code></pre>
<p>And if you want to store the result in a new variable, use the <code>:=</code> operator</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,newVar<span class="op">:</span><span class="er">=</span><span class="kw">log</span>(price<span class="op">/</span>powerPS),]</code></pre></div>
<p>Or create multiple variables at once. The syntax <code>c(&quot;A&quot;,&quot;B&quot;):=.(expression1,expression2)</code>is read “save the <strong>list</strong> of results from expression1 and expression2 using the <strong>vector</strong> of names A, and B”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">auto[,<span class="kw">c</span>(<span class="st">&#39;newVar&#39;</span>,<span class="st">&#39;newVar2&#39;</span>)<span class="op">:</span><span class="er">=</span>.(<span class="kw">log</span>(price<span class="op">/</span>powerPS),price<span class="op">^</span><span class="dv">2</span><span class="op">/</span>powerPS),]</code></pre></div>
</div>
<div id="join" class="section level2">
<h2><span class="header-section-number">4.2</span> Join</h2>
<p><strong>data.table</strong> can be used for joining. A <em>join</em> is the operation of aligning two (or more) data frames/tables along some index. The index can be a single variable, or a combination thereof.</p>
<p>Here is a simple example of aligning age and gender from two different data tables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT1 &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">Names=</span><span class="kw">c</span>(<span class="st">&quot;Alice&quot;</span>,<span class="st">&quot;Bob&quot;</span>), <span class="dt">Age=</span><span class="kw">c</span>(<span class="dv">29</span>,<span class="dv">31</span>))
DT2 &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">Names=</span><span class="kw">c</span>(<span class="st">&quot;Alice&quot;</span>,<span class="st">&quot;Bob&quot;</span>,<span class="st">&quot;Carl&quot;</span>), <span class="dt">Gender=</span><span class="kw">c</span>(<span class="st">&quot;F&quot;</span>,<span class="st">&quot;M&quot;</span>,<span class="st">&quot;M&quot;</span>))
<span class="kw">setkey</span>(DT1, Names)
<span class="kw">setkey</span>(DT2, Names)
DT1[DT2,,] </code></pre></div>
<pre><code>##    Names Age Gender
## 1: Alice  29      F
## 2:   Bob  31      M
## 3:  Carl  NA      M</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT2[DT1,,] </code></pre></div>
<pre><code>##    Names Gender Age
## 1: Alice      F  29
## 2:   Bob      M  31</code></pre>
<p>Things to note:</p>
<ul>
<li>A join with <code>data.tables</code> is performed by indexing one <code>data.table</code> with another. Which is the outer and which is the inner will affect the result.</li>
<li>The indexing variable needs to be set using the <code>setkey</code> function.</li>
</ul>
<p>There are several types of joins:</p>
<ul>
<li><strong>Inner join</strong>: Returns the rows along the intersection of keys, i.e., rows that appear in <strong>all</strong> data sets.</li>
<li><strong>Outer join</strong>: Returns the rows along the union of keys, i.e., rows that appear in <strong>any</strong> of the data sets.</li>
<li><strong>Left join</strong>: Returns the rows along the index of the “left” data set.</li>
<li><strong>Right join</strong>: Returns the rows along the index of the “right” data set.</li>
</ul>
<p>Assuming <code>DT1</code> is the “left” data set, we see that <code>DT1[DT2,,]</code> is a right join, and <code>DT2[DT1,,]</code> is a left join. For an inner join use the <code>nomath=0</code> argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT1[DT2,,,nomatch=<span class="dv">0</span>]</code></pre></div>
<pre><code>##    Names Age Gender
## 1: Alice  29      F
## 2:   Bob  31      M</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT2[DT1,,,nomatch=<span class="dv">0</span>]</code></pre></div>
<pre><code>##    Names Gender Age
## 1: Alice      F  29
## 2:   Bob      M  31</code></pre>
</div>
<div id="reshaping-data" class="section level2">
<h2><span class="header-section-number">4.3</span> Reshaping data</h2>
<p>Data sets (i.e. frames or tables) may arrive in a “wide” form or a “long” form. The difference is best illustrated with an example. The <code>ChickWeight</code> data encodes the weight of various chicks. It is “long” in that a variable encodes the time of measurement, making the data, well, simply long:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ChickWeight <span class="op">%&gt;%</span><span class="st">  </span>head</code></pre></div>
<pre><code>## Grouped Data: weight ~ Time | Chick
##   weight Time Chick Diet
## 1     42    0     1    1
## 2     51    2     1    1
## 3     59    4     1    1
## 4     64    6     1    1
## 5     76    8     1    1
## 6     93   10     1    1</code></pre>
<p>The <code>mtcars</code> data encodes 11 characteristics of 32 types of automobiles. It is “wide” since the various characteristics are encoded in different variables, making the data, well, simply wide.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<p>Most of <em>R</em>’s functions, with exceptions, will prefer data in the long format. There are thus various facilities to convert from one format to another. We will focus on the <code>melt</code> and <code>dcast</code> functions to convert from one format to another.</p>
<div id="wide-to-long" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Wide to long</h3>
<p><code>melt</code> will convert from wide to long.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dimnames</span>(mtcars)</code></pre></div>
<pre><code>## [[1]]
##  [1] &quot;Mazda RX4&quot;           &quot;Mazda RX4 Wag&quot;       &quot;Datsun 710&quot;         
##  [4] &quot;Hornet 4 Drive&quot;      &quot;Hornet Sportabout&quot;   &quot;Valiant&quot;            
##  [7] &quot;Duster 360&quot;          &quot;Merc 240D&quot;           &quot;Merc 230&quot;           
## [10] &quot;Merc 280&quot;            &quot;Merc 280C&quot;           &quot;Merc 450SE&quot;         
## [13] &quot;Merc 450SL&quot;          &quot;Merc 450SLC&quot;         &quot;Cadillac Fleetwood&quot; 
## [16] &quot;Lincoln Continental&quot; &quot;Chrysler Imperial&quot;   &quot;Fiat 128&quot;           
## [19] &quot;Honda Civic&quot;         &quot;Toyota Corolla&quot;      &quot;Toyota Corona&quot;      
## [22] &quot;Dodge Challenger&quot;    &quot;AMC Javelin&quot;         &quot;Camaro Z28&quot;         
## [25] &quot;Pontiac Firebird&quot;    &quot;Fiat X1-9&quot;           &quot;Porsche 914-2&quot;      
## [28] &quot;Lotus Europa&quot;        &quot;Ford Pantera L&quot;      &quot;Ferrari Dino&quot;       
## [31] &quot;Maserati Bora&quot;       &quot;Volvo 142E&quot;         
## 
## [[2]]
##  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;
## [11] &quot;carb&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars<span class="op">$</span>type &lt;-<span class="st"> </span><span class="kw">rownames</span>(mtcars)
<span class="kw">melt</span>(mtcars, <span class="dt">id.vars=</span><span class="kw">c</span>(<span class="st">&quot;type&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>##                type variable value
## 1         Mazda RX4      mpg  21.0
## 2     Mazda RX4 Wag      mpg  21.0
## 3        Datsun 710      mpg  22.8
## 4    Hornet 4 Drive      mpg  21.4
## 5 Hornet Sportabout      mpg  18.7
## 6           Valiant      mpg  18.1</code></pre>
<p>Things to note:</p>
<ul>
<li>The car type was originally encoded in the rows’ names, and not as a variable. We thus created an explicit variable with the cars’ type using the <code>rownames</code> function.</li>
<li>The <code>id.vars</code> of the <code>melt</code> function names the variables that will be used as identifiers. All other variables are assumed to be measurements. These can have been specified using their index instead of their name.</li>
<li>If not all variables are measurements, we could have names measurement variables explicitly using the <code>measure.vars</code> argument of the <code>melt</code> function. These can have been specified using their index instead of their name.</li>
<li>By default, the molten columns are automatically named <code>variable</code> and <code>value</code>.</li>
</ul>
<p>We can replace the automatic namings using <code>variable.name</code> and <code>value.name</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">melt</span>(mtcars, <span class="dt">id.vars=</span><span class="kw">c</span>(<span class="st">&quot;type&quot;</span>), <span class="dt">variable.name=</span><span class="st">&quot;Charachteristic&quot;</span>, <span class="dt">value.name=</span><span class="st">&quot;Measurement&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>head</code></pre></div>
<pre><code>##                type Charachteristic Measurement
## 1         Mazda RX4             mpg        21.0
## 2     Mazda RX4 Wag             mpg        21.0
## 3        Datsun 710             mpg        22.8
## 4    Hornet 4 Drive             mpg        21.4
## 5 Hornet Sportabout             mpg        18.7
## 6           Valiant             mpg        18.1</code></pre>
</div>
<div id="long-to-wide" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Long to wide</h3>
<p><code>dcast</code> will convert from long to wide:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dcast</span>(ChickWeight, Chick<span class="op">~</span>Time, <span class="dt">value.var=</span><span class="st">&quot;weight&quot;</span>)</code></pre></div>
<pre><code>##    Chick  0  2  4  6   8  10  12  14  16  18  20  21
## 1     18 39 35 NA NA  NA  NA  NA  NA  NA  NA  NA  NA
## 2     16 41 45 49 51  57  51  54  NA  NA  NA  NA  NA
## 3     15 41 49 56 64  68  68  67  68  NA  NA  NA  NA
## 4     13 41 48 53 60  65  67  71  70  71  81  91  96
## 5      9 42 51 59 68  85  96  90  92  93 100 100  98
## 6     20 41 47 54 58  65  73  77  89  98 107 115 117
## 7     10 41 44 52 63  74  81  89  96 101 112 120 124
## 8      8 42 50 61 71  84  93 110 116 126 134 125  NA
## 9     17 42 51 61 72  83  89  98 103 113 123 133 142
## 10    19 43 48 55 62  65  71  82  88 106 120 144 157
## 11     4 42 49 56 67  74  87 102 108 136 154 160 157
## 12     6 41 49 59 74  97 124 141 148 155 160 160 157
## 13    11 43 51 63 84 112 139 168 177 182 184 181 175
## 14     3 43 39 55 67  84  99 115 138 163 187 198 202
## 15     1 42 51 59 64  76  93 106 125 149 171 199 205
## 16    12 41 49 56 62  72  88 119 135 162 185 195 205
## 17     2 40 49 58 72  84 103 122 138 162 187 209 215
## 18     5 41 42 48 60  79 106 141 164 197 199 220 223
## 19    14 41 49 62 79 101 128 164 192 227 248 259 266
## 20     7 41 49 57 71  89 112 146 174 218 250 288 305
## 21    24 42 52 58 74  66  68  70  71  72  72  76  74
## 22    30 42 48 59 72  85  98 115 122 143 151 157 150
## 23    22 41 55 64 77  90  95 108 111 131 148 164 167
## 24    23 43 52 61 73  90 103 127 135 145 163 170 175
## 25    27 39 46 58 73  87 100 115 123 144 163 185 192
## 26    28 39 46 58 73  92 114 145 156 184 207 212 233
## 27    26 42 48 57 74  93 114 136 147 169 205 236 251
## 28    25 40 49 62 78 102 124 146 164 197 231 259 265
## 29    29 39 48 59 74  87 106 134 150 187 230 279 309
## 30    21 40 50 62 86 125 163 217 240 275 307 318 331
## 31    33 39 50 63 77  96 111 137 144 151 146 156 147
## 32    37 41 48 56 68  80  83 103 112 135 157 169 178
## 33    36 39 48 61 76  98 116 145 166 198 227 225 220
## 34    31 42 53 62 73  85 102 123 138 170 204 235 256
## 35    39 42 50 61 78  89 109 130 146 170 214 250 272
## 36    38 41 49 61 74  98 109 128 154 192 232 280 290
## 37    32 41 49 65 82 107 129 159 179 221 263 291 305
## 38    40 41 55 66 79 101 120 154 182 215 262 295 321
## 39    34 41 49 63 85 107 134 164 186 235 294 327 341
## 40    35 41 53 64 87 123 158 201 238 287 332 361 373
## 41    44 42 51 65 86 103 118 127 138 145 146  NA  NA
## 42    45 41 50 61 78  98 117 135 141 147 174 197 196
## 43    43 42 55 69 96 131 157 184 188 197 198 199 200
## 44    41 42 51 66 85 103 124 155 153 175 184 199 204
## 45    47 41 53 66 79 100 123 148 157 168 185 210 205
## 46    49 40 53 64 85 108 128 152 166 184 203 233 237
## 47    46 40 52 62 82 101 120 144 156 173 210 231 238
## 48    50 41 54 67 84 105 122 155 175 205 234 264 264
## 49    42 42 49 63 84 103 126 160 174 204 234 269 281
## 50    48 39 50 62 80 104 125 154 170 222 261 303 322</code></pre>
<p>Things to note:</p>
<ul>
<li><code>dcast</code> uses a formula interface (<code>~</code>) to specify the row identifier and the variables. The LHS is the row identifier, and the RHS for the variables to be created.</li>
<li>The measurement of each LHS at each RHS, is specified using the <code>value.var</code> argument.</li>
</ul>
</div>
</div>
<div id="bibliographic-notes-2" class="section level2">
<h2><span class="header-section-number">4.4</span> Bibliographic Notes</h2>
<p><code>data.table</code> has excellent online documentation. See <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">here</a>. See <a href="https://rstudio-pubs-static.s3.amazonaws.com/52230_5ae0d25125b544caab32f75f0360e775.html">here</a> for <strong>joining</strong>. See <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-reshape.html">here</a> for more on <strong>reshaping</strong>. See <a href="https://www.r-bloggers.com/intro-to-the-data-table-package/">here</a> for a comparison of the <code>data.frame</code> way, versus the <code>data.table</code> way. For some advanced tips and tricks see <a href="http://brooksandrew.github.io/simpleblog/articles/advanced-data-table/">Andrew Brooks’ blog</a>.</p>
</div>
<div id="practice-yourself-1" class="section level2">
<h2><span class="header-section-number">4.5</span> Practice Yourself</h2>
<ol style="list-style-type: decimal">
<li>Create a matrix of ones with <code>1e5</code> rows and <code>1e2</code> columns. Create a <code>data.table</code> using this matrix.
<ol style="list-style-type: decimal">
<li>Replace the first column of each, with the sequence <span class="math inline">\(1,2,3,\dots\)</span>.</li>
<li>Create a column which is the sum of all columns, and a <span class="math inline">\(\mathcal{N}(0,1)\)</span> random variable.</li>
</ol></li>
<li>Use the cars dataset used in this chapter from kaggle <a href="https://www.kaggle.com/orgesleka/used-cars-database">Kaggle</a>.
<ol style="list-style-type: decimal">
<li>Import the data using the function <code>fread</code>. What is the class of your object?</li>
<li>Use <code>system.time()</code> to measure the time to sort along “seller”. Do the same after converting the data to <code>data.frame</code>. Are data tables faster?</li>
</ol></li>
</ol>
<p>Also, see DataCamp’s <a href="https://www.datacamp.com/courses/data-manipulation-in-r-with-datatable">Data Manipulation in R with data.table</a>, by Matt Dowle, the author of <em>data.table</em> for more self practice.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="eda.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/26-datatable.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["Rcourse.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
